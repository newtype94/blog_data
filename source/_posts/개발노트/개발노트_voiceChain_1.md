---
title: voiceChain(1) - 아이디어 조사
date: 2020-01-21 13:57:11
tags:
  - 개발노트
category:
  - 개발노트
  - voiceChain
---

# 아이디어 착안

아이디어는 "녹음본의 무결성을 어떻게 증명할 수 있을까?"에서 시작한다.

처음 생각한 방법은 사용자의 어플리케이션에서 녹음이 완료된 순간
해시값을 획득하여 운영자의 서버에 저장하는 것이었다.

그러나 개인이 운영하는 서버는 기업에 비해 보안이 약할 수 밖에 없다.
그래서 블록체인을 활용하기로 했다.

# 장애물

생각보다 장애물이 많았다.

1. 이더리움 플랫폼을 사용해 dappp을 개발하면
   트랜잭션마다 "가스"를 지불해야 한다. (가스는 코인의 작은 단위이다)
   결국 유저가 해시를 업로드려면 원치 않아도 비트코인을 운용해야만 한다.
2. 이더리움 네트워크를 사용하는 경우, 그렇지 않은 경우 모두
   검증의 효력을 위해, 전체 블록을 저장하는 풀노드가 많아야만 한다.
   풀노드를 유지하는 것은 하드웨어 자원을 많이 요구한다.
   적절한 보상이 없다면 풀노드를 자청하는 사람은 없을 것이다.

# 장애물 극복

1. 이더리움 플랫폼을 사용하지 않는다.
   토렌트와 비슷한 원리로 중앙노드(우리 서버)를 거쳐
   최소한의 정보를 획득한 후 트랜잭션을 한다. (프라이빗 블록체인)
2. 코인 시스템을 사용하지 않으므로 풀노드 유저에게 보상을 지급할 다른 방법이 필요하다.
   풀노드 홀딩 시간에 비례해 캐시슬라이드와 같이 현금화 가능한 포인트를 지급할 것이다.

# 아키텍쳐

## 클라이언트(앱) - React Native(expo), sqlite

1. mobile은 pc보다 풀노드를 유지하는 것에 유리하다.
   대부분의 스마트폰은 24시간 전원이 유지되고 있고, 24시간 인터넷 망에 연결되어 있다.
   또한 mobile의 capacity도 점점 커지고 있다. (갤럭시 S10+ 기준 최대 1TB)
2. nodejs는 유용한 npm 모듈을 무료로 사용할 수 있다는 것이 큰 장점이다.
   (녹음 component, hash 계산 모듈, 소켓 모듈 등 사용 예정)
3. sqlite로 클라이언트 단에 블록을 저장할 수 있다.

## 중앙 서버 - expressJS, SocketIO

1. 토렌트와 비슷하게 각 노드의 위치 정보를 담아두고, 빠른 속도로 응답해야 한다.
2. 필요하다면 pm2와 nginx를 사용하여 얼마든지 로드밸런싱을 할 수 있다.

## 데이터베이스 - redis vs mariadb caching

1. 이건 도입하기전에 성능 테스트를 해볼 계획이다.

# 특수한 상황

1. 클라이언트가 루팅(kingoapp)으로 sqlite에 접근하여 블록을 임의 수정/추가하는 경우

   - new block은 서버 단에서 생성한다.
   - 풀노드의 50프로 이상의 동의가 있으면 new block를 전파한다
   - 보통은 블록 하나가 insert 될 것이고 악의적인 노드는 무결한 체인으로 update될 것이다.

2. 소켓 room을 가지고 있는 서버가 다운되는 경우

   - 클라이언트가 소켓요청을 하여 room에 다시 join한다.
   - 특정 인원 수가 모이기 전까지 서버 단에서 클라이언트로 블록이 전파되지 않게 한다.
